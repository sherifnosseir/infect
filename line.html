<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="line.css">
    
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
    <script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>
  </head>
  <body>
    <h1>i got it work</h1>
    <canvas id="myCanvas" width="940" height="400"></canvas>
    <script>

      // remove safaru bars (not working?)
      window.addEventListener("load",function() {
        setTimeout(function(){
          window.scrollTo(0, 1);
        }, 1);
      });

      // prevent "bouncing"
      document.ontouchmove = function(e) {e.preventDefault()};

      // $('#myCanvas').click(function() {
      //  var myBlock = document.getElementById('myCanvas');
      //  alert("Hello " + document.getElementById('myCanvas').height);
      // });

      // canvas
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      // maximums/consts
      var maxX = document.getElementById('myCanvas').width; // width of canvas
      var maxY = document.getElementById('myCanvas').height; // height of canvas
      var maxLines = 4; // number of lines to swipe
      var maxCols = 4; // number of cols for lines to appear on
      var lineWidth = 10; // arbitrary width of a line
      var lineDistance = 20; // distance between each line (if multiple) ****** this is dangerous: if maxLines is big enough and numLines rolls high enough, lines could go out of bounds.
      var topAndBottomPadding = 100; // 10 each.
      
      // derived
      var lineLength = Math.floor(maxX/maxCols); // length of each line, or width of each column

      // randoms
      var numLines = Math.floor((Math.random()*maxLines)+1);
      var whichCol = Math.floor((Math.random()*maxCols));
      // var firstY = Math.floor((Math.random()*(maxY-topAndBottomPadding))+topAndBottomPadding/2)-((numLines-1)*lineDistance); // y position of the top line
      var firstY = Math.floor((Math.random()*(maxY-topAndBottomPadding))+topAndBottomPadding/2); // y position of the top line

      // vertical grid
      for (var i = 0; i < maxCols; i++) {
        context.beginPath();
        context.moveTo(i*lineLength, 0);
        context.lineTo(i*lineLength, maxY);
        context.stroke();
      }

      // gogogo
      for (var i = 0; i < numLines; i++) {
        context.beginPath();
        context.moveTo(whichCol*lineLength, firstY+i*lineDistance);
        context.lineTo((whichCol+1)*lineLength, firstY+i*lineDistance);
        context.lineWidth = lineWidth;
        context.lineCap = 'round';
        context.stroke();
      }
      console.log("firstY = " + firstY + ", col = " + whichCol + ", numLines = " + numLines);



      // mousePositions
      var mouseDownX;
      var mouseDownY;
      var mouseUpX;
      var mouseUpY;
      var mousePosX;
      var mousePosY;


      var hit = false;
      var mouseIsDown = false;

      var inCol; // on down click, is in the right col?
      //var leaveCol; // if inCol, does the mouse ever leave?



      canvas.onmousedown = function(e) {
        mouseIsDown = true;
        mouseDownX = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - canvas.offsetLeft;
        mouseDownY = event.clientY + document.body.scrollTop + document.documentElement.scrollTop - canvas.offsetTop;
        if ((mouseDownX >= whichCol*lineLength) && (mouseDownX <= (whichCol+1)*lineLength)) {
          inCol = true;
          //leaveCol = false;
        }
        else {
          inCol = false;
        }
        console.log('\tdown ' + mouseDownX + ", " + mouseDownY + ", inCol = " + inCol);
      }
      canvas.onmouseup = function(e) {
        mouseIsDown = false;
        mouseUpX = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - canvas.offsetLeft;
        mouseUpY = event.clientY + document.body.scrollTop + document.documentElement.scrollTop - canvas.offsetTop;
        console.log('\tup ' + mouseUpX + ", " + mouseUpY);

        // check for hit!
        // check for col first
        if (inCol) {
          // check for all line clear
          if (((mouseDownY <= firstY) && (mouseUpY >= (firstY+(numLines-1)*lineDistance))) || ((mouseUpY <= firstY) && (mouseDownY >= (firstY+(numLines-1)*lineDistance)))){
            hit = true;
            console.log('HIT!!');
          }
          else {
            hit = false;
            console.log('miss');
          }
        }
        else {
          hit = false;
          console.log('miss');
        }
      }

      canvas.onmousemove = function(e) {
        if (!mouseIsDown) {
          return;
        }
        else {
          mousePosX = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - canvas.offsetLeft;
          mousePosY = event.clientY + document.body.scrollTop + document.documentElement.scrollTop - canvas.offsetTop;
          if ((mousePosX < whichCol*lineLength) || (mousePosX > (whichCol+1)*lineLength)) {
            inCol = false;
          }
          console.log('\t\tmove ' + mousePosX + ", " + mousePosY + ", inCol = " + inCol);
        }

      }

      // document.addEventListener("DOMContentLoaded", init, false);

      //  function init()
      //  {
      //    var canvas = document.getElementById("myCanvas");
      //    canvas.addEventListener("mousedown", getPosition, false);
      //    canvas.addEventListener("mouseup", getPosition, false);
      //  }

      //  function getPosition(event)
      //  {
      //    var x = new Number();
      //    var y = new Number();
      //    var canvas = document.getElementById("myCanvas");

      //    if (event.x != undefined && event.y != undefined)
      //    {
      //      x = event.x;
      //      y = event.y;
      //    }
      //    else // Firefox method to get the position
      //    {
      //      x = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
      //      y = event.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      //    }

      //    x -= canvas.offsetLeft;
      //    y -= canvas.offsetTop;

      //    console.log("Down x: " + x + "  y: " + y);
      //  }   





    </script>
  </body>
</html>