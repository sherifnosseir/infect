<!DOCTYPE html>
<html>
	<title>hello world</title>
	<head>
		<script src="/socket.io/socket.io.js"></script>
		<script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>
		
		<script src="/MIDI.js-master/js/MIDI/AudioDetect.js" type="text/javascript"></script>
	 	<script src="/MIDI.js-master/js/MIDI/LoadPlugin.js" type="text/javascript"></script>
		 <script src="MIDI.js-master/js/MIDI/Plugin.js" type="text/javascript"></script>
		 <script src="MIDI.js-master/js/MIDI/Player.js" type="text/javascript"></script>
		 <script src="MIDI.js-master/js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
		 <script src="MIDI.js-master/js/Window/DOMLoader.script.js" type="text/javascript"></script>
	 	<!-- extras -->
		 <script src="MIDI.js-master/inc/Base64.js" type="text/javascript"></script>
		 <script src="MIDI.js-master/inc/base64binary.js" type="text/javascript"></script>
	</head>
	<body>
		<div>
			<input type="button" id="button1" value="button 1">
			<input type="button" id="button2" value="button 2">
			<input type="button" id="button3" value="button 3">
		</div>
		<script>
		
		// MIDI variables
		var player;
		var MIDI;
		var playedKey;
		
		window.onload = function() {
			//Set up MIDI properties
			MIDI.loadPlugin({
				soundfontUrl: "MIDI.js-master/soundfont/",
				instruments: "acoustic_grand_piano",
				callback: function() {
					this.player = MIDI.player;
					this.MIDI = MIDI;
					play();
				}
			});
		};
		
		var socket = io.connect('http://localhost');
		//var socket = io.connect('209.141.61.27');
		socket.on('news', function(data) {
			console.log(data);
			socket.emit('my other event', {
				my : 'data'
			});
		});
		
		function play() {
			//Play method can do whatever we want it to do
			MIDI.programChange(0, 0);
			MIDI.programChange(1, 118);
			
			var delay = 0.75; // play one note every quarter second
			var note = MIDI.pianoKeyOffset + playedKey; // the MIDI note
			var velocity = 127; // how hard the note hits
			// play the note
			MIDI.noteOn(0, note, velocity, delay);
			// play the some note 3-steps up
			MIDI.noteOn(1, note + 3, velocity, delay + 4);		
		}
		
		$('#button1').click(function(){
			playedKey = 25;
			socket.emit('play', playedKey);
			play();
			console.log("Playing client tone");
		});
		
		$('#button2').click(function(){
			playedKey = 50;
			socket.emit('play', playedKey);
			play();
			console.log("Playing client tone");
		});
		
		$('#button3').click(function(){
			playedKey = 75;
			socket.emit('play', playedKey);
			play();
			console.log("Playing client tone");
		});
		
		socket.on('playnote', function(note){
			console.log("note is " + note);
			playedKey = note;
			play();
			console.log("Playing server tone");
		});

		</script>
	</body>
</html>